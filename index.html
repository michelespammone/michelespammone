<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Image with Hat</title>
<style>
  body, html {
    height: 100%;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: white;
    color: black;
  }

  #imageContainer {
    position: relative; /* Set position to relative for absolute positioning of child elements */
    width: 90%;
    max-width: 500px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #imageContainer img {
    width: 100%;
    transition: transform 0.1s ease-in-out; /* Smooth transition for transform */
  }

  #hatImage {
    position: absolute;
    top: 10%; /* Adjust this value to position the hat correctly */
    left: 50%; /* Centers the hat along the width; adjust according to your image */
    transform: translate(-50%, -50%) rotate(0deg); /* Initial transform positioning */
    width: 30%; /* Adjust based on the desired size of the hat relative to the base image */
    transition: transform 0.5s ease-in-out; /* Smooth transition for rotation */
    visibility: hidden; /* Initially hide the hat */
    pointer-events: none; /* Ignore pointer events to keep underlying images clickable */
  }

  audio {
    display: none;
  }
</style>
</head>
<body>

<div id="imageContainer" onclick="startEffects()">
    <img src="1.png" id="imageDisplay" alt="Clickable Image">
    <img src="hat.png" id="hatImage" alt="Hat Image">
</div>

<audio id="audioPlayer" loop>
  <source src="audio.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
  let imageSwapFlag = false;
  let intervalId = null;
  let hatVisible = false;
  let imagesToPreload = ["1.png", "2.png", "hat.png"];
  let preloadedImages = [];

  function preloadImages() {
    for (let i = 0; i < imagesToPreload.length; i++) {
      preloadedImages[i] = new Image();
      preloadedImages[i].src = imagesToPreload[i];
    }
  }

  function startEffects() {
    if (intervalId === null) {
      document.getElementById('audioPlayer').play();
      intervalId = setInterval(swapImage, 80);
    }
    jiggleImages();
    
    if (!hatVisible) {
      toggleHatVisibility();
      hatVisible = true;
    }
  }

  function jiggleImages() {
    const imgContainer = document.getElementById('imageContainer');
    imgContainer.style.transform = 'scale(1.1)';
    setTimeout(() => {
      imgContainer.style.transform = '';
    }, 100); // Reset scaling
  }

  function swapImage() {
    const img = document.getElementById('imageDisplay');
    img.src = imageSwapFlag ? "1.png" : "2.png";
    imageSwapFlag = !imageSwapFlag;
  }

  function toggleHatVisibility() {
    const hat = document.getElementById('hatImage');
    hat.style.visibility = 'visible'; // Make the hat visible after the first click
    setTimeout(function() {
      rotateHat(20); // Rotate hat by 20 degrees; modify as needed
    }, 1000); // Delay the rotation to see the effect clearly
  }

  function rotateHat(degrees) {
    const hat = document.getElementById('hatImage');
    hat.style.transform = `translate(-50%, -50%) rotate(${degrees}deg)`;
  }

  // Preload images on window load
  window.onload = preloadImages;
</script>

</body>
</html>
