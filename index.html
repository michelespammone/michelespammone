<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Image Swap with Confetti</title>
<style>
  body, html {
    height: 100%;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: white;
    color: black;
  }

  #imageContainer {
    width: 90%;
    max-width: 500px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  img {
    width: 100%;
    transition: transform 0.1s ease-in-out;
  }

  audio {
    display: none;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>
</head>
<body>

<div id="imageContainer" onclick="startEffects()">
  <img src="1.png" id="imageDisplay" alt="Clickable Image">
</div>

<audio id="audioPlayer" loop>
  <source src="audio.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
  let imageSwapFlag = false;
  let intervalId = null;
  let imagesToPreload = ["1.png", "a.png", "b.png"];
  let preloadedImages = [];
  let audioFilesToPreload = ["audio.mp3"];
  let preloadedAudioFiles = [];
  
  function preloadResources() {
    imagesToPreload.forEach(function(image) {
      let img = new Image();
      img.src = image;
      preloadedImages.push(img);
    });

    audioFilesToPreload.forEach(function(audio) {
      let audioFile = new Audio();
      audioFile.src = audio;
      preloadedAudioFiles.push(audioFile);
    });
  }

  function startEffects() {
    if (intervalId === null) {
      document.getElementById('audioPlayer').play();
      intervalId = setInterval(swapImage, 80);
      startConfetti(); // Start confetti animation

      document.addEventListener("DOMContentLoaded", function() {
        const imageContainer = document.getElementById('imageContainer');
        const imageDisplay = document.getElementById('imageDisplay');
        const ctx = imageContainer.appendChild(document.createElement('canvas')).getContext('2d');
        let color = '#FF0000'; // Initial color for the lines
      
        // Set up canvas element
        imageContainer.style.position = 'relative';
        imageContainer.addEventListener('mousemove', drawLines);
      
        function drawLines(event) {
          const rect = imageDisplay.getBoundingClientRect();
          const mouseX = event.clientX - rect.left;
          const mouseY = event.clientY - rect.top;
        
          const eyePoints = [{ x: 50, y: 50 }, { x: 250, y: 50 }]; // Point coordinates for the eyes
          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        
          ctx.beginPath();
          ctx.moveTo(eyePoints[0].x, eyePoints[0].y);
          ctx.lineTo(mouseX, mouseY);
          ctx.strokeStyle = color;
          ctx.stroke();
          ctx.closePath();
        
          ctx.beginPath();
          ctx.moveTo(eyePoints[1].x, eyePoints[1].y);
          ctx.lineTo(mouseX, mouseY);
          ctx.strokeStyle = color;
          ctx.stroke();
          ctx.closePath();
      
          // Change color for the lines continuously
          color = `hsl(${Math.floor(Date.now() / 10) % 360}, 80%, 50%)`;
        }
      });
    }
    jiggleImage();
  }

   function jiggleImage() {
    const img = document.getElementById('imageDisplay');
    img.style.transform = 'scale(1.1)';
    setTimeout(() => {
      img.style.transform = '';
    }, 100); // Reset scaling
  }
  
  function swapImage() {
    const img = document.getElementById('imageDisplay');
    img.src = imageSwapFlag ? "a.png" : "b.png";
    imageSwapFlag = !imageSwapFlag;
  }

  function startConfetti() {
    var duration = 15 * 1000;
    var animationEnd = Date.now() + duration;
    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

    function randomInRange(min, max) {
      return Math.random() * (max - min) + min;
    }

    var interval = setInterval(function() {
      var timeLeft = animationEnd - Date.now();
      if (timeLeft <= 0) {
        return clearInterval(interval);
      }

      var particleCount = 50 * (timeLeft / duration);
      confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
      confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
    }, 250);
  }

  // Preload images and audio files on window load
  window.onload = preloadResources;
</script>

</body>
</html>
